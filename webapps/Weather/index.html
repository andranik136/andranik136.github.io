<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Weather App</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap');

        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #42b983;
            --text-color: #ecf0f1;
            --card-bg: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        #app {
            width: 90%;
            max-width: 800px;
            padding: 2rem;
            border-radius: 1.5rem;
            background: var(--secondary-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .loading, .error {
            font-size: 1.2rem;
            margin-top: 2rem;
        }

        /* Settings Button */
        .settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            color: var(--text-color);
        }

        .settings-btn svg {
            width: 28px;
            height: 28px;
            transition: transform 0.3s ease;
        }
        .settings-btn:hover svg {
            transform: rotate(60deg);
        }

        /* Current Weather Section */
        .current-weather {
            margin-bottom: 2rem;
        }

        .current-weather .location {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .current-weather .temperature {
            font-size: 5rem;
            font-weight: 300;
            margin: 0.5rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .current-weather .temperature span {
            font-size: 2rem;
            font-weight: 400;
        }

        .current-weather .condition {
            font-size: 1.5rem;
            font-weight: 400;
        }

        .current-details {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .detail-item {
            font-size: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        .detail-item .value {
            font-weight: 700;
        }

        /* Weekly Forecast */
        .weekly-forecast {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .forecast-card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1rem 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .forecast-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .forecast-card .day {
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .forecast-card .temp-range {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* SVG Icons */
        .weather-icon {
            width: 80px;
            height: 80px;
        }

        .forecast-icon {
            width: 50px;
            height: 50px;
        }

        /* Settings Modal */
        .settings-modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .settings-content {
            background: var(--secondary-color);
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 80%;
            max-width: 400px;
            text-align: left;
        }
        
        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-content h2 {
            margin-top: 0;
            font-size: 1.5rem;
        }

        .settings-content input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--text-color);
            border-radius: 0.5rem;
            background: var(--primary-color);
            color: var(--text-color);
            box-sizing: border-box;
        }

        .settings-content button {
            width: 100%;
            padding: 0.75rem;
            background: var(--accent-color);
            border: none;
            border-radius: 0.5rem;
            color: var(--primary-color);
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .settings-content button:hover {
            background: #39a374;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-color);
        }

        /* Radio button group for units */
        .radio-group {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .radio-group label {
            cursor: pointer;
            font-weight: 400;
        }

        .radio-group input[type="radio"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid var(--text-color);
            border-radius: 50%;
            margin-right: 0.5rem;
            vertical-align: middle;
            position: relative;
            top: -1px;
            cursor: pointer;
        }

        .radio-group input[type="radio"]:checked {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }

        /* SVG Animations */
        .sun-animation {
            transform-origin: center;
            animation: rotate 10s linear infinite;
        }

        .cloud-animation {
            animation: move-cloud 15s linear infinite alternate;
        }

        .rain-animation {
            opacity: 0.7;
            animation: fall-rain 1s linear infinite;
        }

        .bolt-animation {
            opacity: 0;
            animation: flash 1s ease-in-out infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes move-cloud {
            from { transform: translateX(0); }
            to { transform: translateX(10px); }
        }

        @keyframes fall-rain {
            from { transform: translateY(0); opacity: 0; }
            to { transform: translateY(20px); opacity: 1; }
        }

        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <h1>Weather App</h1>
        <button class="settings-btn" @click="toggleSettings">
            <!-- New settings icon from SVG Repo -->
            <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.5 22C11.66 22 11.83 22 12 22C12.17 22 12.34 22 12.5 22L12.75 20.5H11.25L11.5 22M15 19H17L18.75 20.5H16.25L15.5 19M19.5 16.5H21.5L23 18.25V15.75L21.5 16.5M22 11.5L20.5 11.25V12.75L22 12.5V11.5M19 9H17L15.5 8.25V10.75L15 9M16.5 4.5H18.5L20 6.25V3.75L18.5 4.5M14 2H10V0H14V2M9 5H7L5.5 3.75V6.25L5 5M4.5 9H2.5L1 10.75V8.25L2.5 9M2 13H0V11H2V13M3.75 18.5L5.25 16.5L3.75 14.25L2.5 15.5H5.5L3.75 18.5M8.25 20.5L10.75 18.5L9.25 16.5H6.75L8.25 20.5M12 18A6 6 0 0 1 6 12A6 6 0 0 1 12 6A6 6 0 0 1 18 12A6 6 0 0 1 12 18Z"/>
            </svg>
        </button>
    </div>

    <div v-if="loading" class="loading">
        Loading weather data...
    </div>

    <div v-else-if="error" class="error">
        {{ error }}
    </div>

    <div v-else class="weather-container">
        <!-- Current Weather -->
        <div class="current-weather">
            <h2 class="location">{{ location }}</h2>
            <div class="weather-icon">
                <div v-html="getWeatherIcon(weatherData.current.weather_code)"></div>
            </div>
            <div class="temperature">
                {{ Math.round(weatherData.current.temperature_2m) }}<span>{{ unitSymbol }}</span>
            </div>
            <div class="condition">
                {{ getWeatherDescription(weatherData.current.weather_code) }}
            </div>
            <div class="current-details">
                <div class="detail-item">
                    <span class="value">{{ uvIndex }}</span>
                    <span>UV Index</span>
                </div>
                <div class="detail-item">
                    <span class="value">{{ aqi }}</span>
                    <span>AQI</span>
                </div>
            </div>
        </div>

        <!-- Weekly Forecast -->
        <div class="weekly-forecast">
            <div v-for="(day, index) in weeklyForecast" :key="index" class="forecast-card">
                <div class="day">{{ getDayName(day.time) }}</div>
                <div class="forecast-icon">
                    <div v-html="getWeatherIcon(day.weather_code)"></div>
                </div>
                <div class="temp-range">
                    {{ Math.round(day.temperature_2m_max) }}° / {{ Math.round(day.temperature_2m_min) }}°
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div :class="['settings-modal', { 'active': isSettingsVisible }]">
        <div class="settings-content">
            <button class="close-btn" @click="toggleSettings">&times;</button>
            <div class="settings-section">
                <h2>Change Location</h2>
                <p>Enter a ZIP code to get the weather for that location.</p>
                <input type="text" v-model="zipCodeInput" placeholder="e.g., 90210" @keyup.enter="fetchByZipCode">
                <button @click="fetchByZipCode">Get Weather</button>
            </div>
            <div class="settings-section">
                <h2>Temperature Units</h2>
                <p>Select your preferred temperature unit.</p>
                <div class="radio-group">
                    <label>
                        <input type="radio" value="celsius" v-model="unit">
                        Celsius
                    </label>
                    <label>
                        <input type="radio" value="fahrenheit" v-model="unit">
                        Fahrenheit
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/vue@3"></script>
<script>
    // This is the main Vue.js application instance.
    const app = Vue.createApp({
        data() {
            return {
                // Main data objects to store weather and location info.
                weatherData: null,
                weeklyForecast: [],
                uvIndex: 'N/A',
                aqi: 'N/A',
                location: 'Your Location',
                // UI state variables.
                loading: true,
                error: null,
                isSettingsVisible: false,
                zipCodeInput: '',
                // Unit setting for temperature, defaults to Celsius.
                unit: 'celsius'
            };
        },
        computed: {
            // Vue computed property to map weather codes to SVG icons.
            getWeatherIcon() {
                return (weatherCode) => {
                    const icons = {
                        // Clear Sky
                        0: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="sun-animation">
                              <path d="M12 2C16.9706 2 21 6.02944 21 11C21 15.9706 16.9706 20 12 20C7.02944 20 3 15.9706 3 11C3 6.02944 7.02944 2 12 2ZM12 4V5M12 17V19M4.2 4.2L5.6 5.6M18.4 17.4L19.8 18.8M2 11H3M21 11H22M4.2 17.4L5.6 18.8M18.4 4.2L19.8 5.6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                           </svg>`,
                        // Mainly clear, partly cloudy
                        1: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="cloud-animation">
                              <path d="M12 4V5M12 17V19M4.2 4.2L5.6 5.6M18.4 17.4L19.8 18.8M2 11H3M21 11H22M4.2 17.4L5.6 18.8M18.4 4.2L19.8 5.6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M16 16.4C18.4 16.4 20.4 14.4 20.4 12C20.4 9.6 18.4 7.6 16 7.6C15.5 7.6 15 7.7 14.5 7.9C13.8 6.4 12.3 5.4 10.6 5.4C8.3 5.4 6.4 7.3 6.4 9.6C6.4 11.9 8.3 13.8 10.6 13.8L16 13.8V16.4Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                           </svg>`,
                        // Overcast, fog
                        2: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="cloud-animation">
                               <path d="M16 16.4C18.4 16.4 20.4 14.4 20.4 12C20.4 9.6 18.4 7.6 16 7.6C15.5 7.6 15 7.7 14.5 7.9C13.8 6.4 12.3 5.4 10.6 5.4C8.3 5.4 6.4 7.3 6.4 9.6C6.4 11.9 8.3 13.8 10.6 13.8L16 13.8V16.4Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                           </svg>`,
                        // Rain, drizzle
                        51: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                               <path d="M16 16.4C18.4 16.4 20.4 14.4 20.4 12C20.4 9.6 18.4 7.6 16 7.6C15.5 7.6 15 7.7 14.5 7.9C13.8 6.4 12.3 5.4 10.6 5.4C8.3 5.4 6.4 7.3 6.4 9.6C6.4 11.9 8.3 13.8 10.6 13.8L16 13.8V16.4Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                               <path class="rain-animation" d="M12 18V22M9 16V20M15 16V20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                           </svg>`,
                        // Thunderstorm
                        95: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 16.4C18.4 16.4 20.4 14.4 20.4 12C20.4 9.6 18.4 7.6 16 7.6C15.5 7.6 15 7.7 14.5 7.9C13.8 6.4 12.3 5.4 10.6 5.4C8.3 5.4 6.4 7.3 6.4 9.6C6.4 11.9 8.3 13.8 10.6 13.8L16 13.8V16.4Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                <path class="bolt-animation" d="M12 14L9 22L15 16L12 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>`,
                        // Default for other conditions
                        default: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                     <path d="M12 2C16.9706 2 21 6.02944 21 11C21 15.9706 16.9706 20 12 20C7.02944 20 3 15.9706 3 11C3 6.02944 7.02944 2 12 2Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                  </svg>`
                    };
                    return icons[weatherCode] || icons.default;
                };
            },
            // Maps weather codes to descriptions for readability.
            getWeatherDescription() {
                return (weatherCode) => {
                    const descriptions = {
                        0: "Clear Sky",
                        1: "Partly Cloudy",
                        2: "Cloudy",
                        3: "Overcast",
                        45: "Fog",
                        48: "Depositing Rime Fog",
                        51: "Drizzle",
                        53: "Drizzle",
                        55: "Dense Drizzle",
                        56: "Freezing Drizzle",
                        57: "Dense Freezing Drizzle",
                        61: "Rain",
                        63: "Rain",
                        65: "Heavy Rain",
                        66: "Freezing Rain",
                        67: "Heavy Freezing Rain",
                        71: "Snow Fall",
                        73: "Moderate Snow Fall",
                        75: "Heavy Snow Fall",
                        77: "Snow Grains",
                        80: "Rain Showers",
                        81: "Rain Showers",
                        82: "Violent Rain Showers",
                        85: "Snow Showers",
                        86: "Snow Showers",
                        95: "Thunderstorm",
                        96: "Thunderstorm with Hail",
                        99: "Thunderstorm with Hail"
                    };
                    return descriptions[weatherCode] || "Unknown";
                };
            },
            // Maps a date string to a day name (e.g., "Mon").
            getDayName() {
                return (dateStr) => {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('en-US', { weekday: 'short' });
                };
            },
            // Computed property for the correct temperature unit symbol.
            unitSymbol() {
                return this.unit === 'celsius' ? '°C' : '°F';
            }
        },
        watch: {
            // Watch for changes in the 'unit' data property.
            unit(newUnit, oldUnit) {
                // When the unit changes, re-fetch the weather data with the new unit.
                if (newUnit !== oldUnit) {
                    this.fetchWeatherByCurrentLocation();
                }
            }
        },
        methods: {
            // Toggles the visibility of the settings modal.
            toggleSettings() {
                this.isSettingsVisible = !this.isSettingsVisible;
            },
            // Fetches weather data based on the user's current latitude and longitude.
            async fetchWeatherByCurrentLocation() {
                this.loading = true;
                this.error = null;
                this.location = 'Your Location';
                if ("geolocation" in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            const { latitude, longitude } = position.coords;
                            await this.fetchWeatherData(latitude, longitude);
                        },
                        (err) => {
                            // The error callback handles cases where the user denies permission
                            // or the location service fails.
                            console.error("Geolocation error:", err);
                            this.error = "Couldn't get your location. Please ensure location services are enabled for your browser.";
                            this.loading = false;
                        }
                    );
                } else {
                    this.error = "Geolocation is not supported by your browser. Please use the ZIP code search.";
                    this.loading = false;
                }
            },
            // Fetches weather data for a given latitude and longitude.
            async fetchWeatherData(lat, lon) {
                this.loading = true;
                this.error = null;
                try {
                    // Determine the temperature unit for the API request.
                    const tempUnitParam = this.unit === 'fahrenheit' ? '&temperature_unit=fahrenheit' : '';

                    // Fetch weather forecast and details
                    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=7&uv_index=true${tempUnitParam}`;
                    const weatherResponse = await fetch(weatherUrl);
                    if (!weatherResponse.ok) {
                        throw new Error("Failed to fetch weather data.");
                    }
                    this.weatherData = await weatherResponse.json();
                    this.weeklyForecast = this.weatherData.daily;
                    this.uvIndex = this.weatherData.daily.uv_index_max[0] || 'N/A';

                    // Fetch air quality data
                    const aqiUrl = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=european_aqi&timezone=auto`;
                    const aqiResponse = await fetch(aqiUrl);
                    if (!aqiResponse.ok) {
                        throw new Error("Failed to fetch air quality data.");
                    }
                    const aqiData = await aqiResponse.json();
                    this.aqi = aqiData.current ? aqiData.current.european_aqi : 'N/A';

                    // Reverse geocoding to get location name
                    const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${lat},${lon}&count=1`;
                    const geoResponse = await fetch(geocodingUrl);
                    const geoData = await geoResponse.json();

                    if (geoData && geoData.results && geoData.results.length > 0) {
                        this.location = `${geoData.results[0].name}, ${geoData.results[0].country}`;
                    } else {
                        // Fallback to coordinates if location name not found
                        this.location = `Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;
                    }

                } catch (e) {
                    console.error("Error fetching data:", e);
                    this.error = "There was an issue retrieving weather data. Please try again.";
                } finally {
                    this.loading = false;
                }
            },
            // Fetches location coordinates from a ZIP code and then gets weather data.
            async fetchByZipCode() {
                this.loading = true;
                this.error = null;
                this.isSettingsVisible = false;

                const zip = this.zipCodeInput.trim();
                if (!zip) {
                    this.error = "Please enter a valid ZIP code.";
                    this.loading = false;
                    return;
                }

                try {
                    const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${zip}&count=1&language=en&format=json`;
                    const geoResponse = await fetch(geocodingUrl);
                    const geoData = await geoResponse.json();

                    if (geoData && geoData.results && geoData.results.length > 0) {
                        const { latitude, longitude } = geoData.results[0];
                        await this.fetchWeatherData(latitude, longitude);
                    } else {
                        this.error = "Location not found for that ZIP code. Please try a different one.";
                    }
                } catch (e) {
                    console.error("Error fetching location data:", e);
                    this.error = "There was an issue finding that location. Please try again.";
                } finally {
                    this.loading = false;
                }
            }
        },
        mounted() {
            // When the app is mounted, try to get the user's current location.
            this.fetchWeatherByCurrentLocation();
        }
    });

    app.mount('#app');
</script>

</body>
</html>
